[phases.setup]
nixPkgs = ['nginx', 'php82', 'python310Packages.supervisor']

[phases.build]
cmds = [
    '''cat > supervisord.conf << 'EOF'
[supervisord]
nodaemon=true
logfile=/dev/null

[program:php-fpm]
command=php-fpm -F
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

[program:nginx]
command=nginx -g 'daemon off;'
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
EOF'''
]

[start]
cmd = 'supervisord -c supervisord.conf'